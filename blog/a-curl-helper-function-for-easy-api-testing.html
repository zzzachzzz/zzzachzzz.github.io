<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>A Curl Helper Function for Easy API Testing</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/e31161d1940ea64d673b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e31161d1940ea64d673b.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-90a60b87fd0d5fc150f2.js" defer=""></script><script src="/_next/static/chunks/framework-fb2dd7aba3784ca05084.js" defer=""></script><script src="/_next/static/chunks/main-a4c7c12088fb926e1d6d.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b017e07cf5dc4ad6b244.js" defer=""></script><script src="/_next/static/chunks/92-422dc8fa6f40aa99376d.js" defer=""></script><script src="/_next/static/chunks/211-d4f9d46c73b905fd367f.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-47ba31f83957293671e6.js" defer=""></script><script src="/_next/static/RJhSgEuEM-DTGw2xptl7C/_buildManifest.js" defer=""></script><script src="/_next/static/RJhSgEuEM-DTGw2xptl7C/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.2.1">html{font-size:16px;min-height:100vh;}/*!sc*/
html,body{height:100%;margin:0;padding:0;}/*!sc*/
@media only screen and (max-device-width:480px){html{font-size:14px;}}/*!sc*/
body{background-color:#3e4d4f;color:white;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen", "Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue", sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}/*!sc*/
*{box-sizing:border-box;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-weight:400;}/*!sc*/
code{font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;}/*!sc*/
data-styled.g1[id="sc-global-bYaKAX1"]{content:"sc-global-bYaKAX1,"}/*!sc*/
.iQzkww{background-color:#272822;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;padding:0.2em 0.4em;font-size:0.8em;border-radius:0.3em;}/*!sc*/
data-styled.g2[id="Code-sc-1amjnp4-0"]{content:"iQzkww,"}/*!sc*/
.kuhBS{background-color:#272822;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;padding:0.2em 0.4em;font-size:0.8em;border-radius:0.3em;color:#ae81ff;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g3[id="A__A_-sc-14fqd0c-0"]{content:"kuhBS,"}/*!sc*/
.frqqeo{margin:5px;}/*!sc*/
data-styled.g6[id="Navigation___StyledLink-sc-10fffhi-0"]{content:"frqqeo,"}/*!sc*/
.fBDDkv{margin:5px;}/*!sc*/
data-styled.g7[id="Navigation___StyledLink2-sc-10fffhi-1"]{content:"fBDDkv,"}/*!sc*/
.gwcSSF{margin:5px;}/*!sc*/
data-styled.g8[id="Navigation___StyledLink3-sc-10fffhi-2"]{content:"gwcSSF,"}/*!sc*/
.hmTGJm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:1.2em;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g9[id="Navigation__Nav-sc-10fffhi-3"]{content:"hmTGJm,"}/*!sc*/
.kjdbIE{margin:5px;color:white;font-weight:500;line-height:1;}/*!sc*/
data-styled.g10[id="Navigation___StyledSpan-sc-10fffhi-4"]{content:"kjdbIE,"}/*!sc*/
.fOgHwq{margin-left:auto !important;margin-right:auto !important;}/*!sc*/
data-styled.g11[id="TreeToJSX__Pre-sc-1taxolb-0"]{content:"fOgHwq,"}/*!sc*/
.dTmJnK > p{margin:0;}/*!sc*/
data-styled.g13[id="TreeToJSX__Li-sc-1taxolb-2"]{content:"dTmJnK,"}/*!sc*/
.jvwBiV{width:100%;height:100%;object-fit:contain;display:block;}/*!sc*/
data-styled.g14[id="TreeToJSX__Img-sc-1taxolb-3"]{content:"jvwBiV,"}/*!sc*/
.hYmhcO{text-align:center;margin:2em;margin-bottom:0.2em;}/*!sc*/
data-styled.g16[id="slug___StyledH-sc-8mhdoa-0"]{content:"hYmhcO,"}/*!sc*/
.iRnBGj{font-size:0.9em;text-align:center;}/*!sc*/
data-styled.g17[id="slug___StyledP-sc-8mhdoa-1"]{content:"iRnBGj,"}/*!sc*/
.bWFbvA{font-size:1.2em;line-height:1.4em;-webkit-letter-spacing:0.01em;-moz-letter-spacing:0.01em;-ms-letter-spacing:0.01em;letter-spacing:0.01em;overflow-wrap:break-word;padding:1.1em;margin:0 auto;}/*!sc*/
.bWFbvA > *:not(pre){max-width:850px;margin-left:auto;margin-right:auto;}/*!sc*/
.bWFbvA > pre{width:90vw;max-width:1100px;}/*!sc*/
data-styled.g18[id="slug__BlogContentContainer-sc-8mhdoa-2"]{content:"bWFbvA,"}/*!sc*/
</style></head><body><div id="__next"><div><nav class="Navigation__Nav-sc-10fffhi-3 hmTGJm"><a href="/" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS Navigation___StyledLink-sc-10fffhi-0 frqqeo">/</a><span class="Navigation___StyledSpan-sc-10fffhi-4 kjdbIE">&gt;</span><a href="/blog" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS Navigation___StyledLink2-sc-10fffhi-1 fBDDkv">blog</a><span class="Navigation___StyledSpan-sc-10fffhi-4 kjdbIE">&gt;</span><a href="/blog/a-curl-helper-function-for-easy-api-testing" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS Navigation___StyledLink3-sc-10fffhi-2 gwcSSF">a-curl-helper-function-for-easy-api-testing</a></nav><main><header><h1 class="slug___StyledH-sc-8mhdoa-0 hYmhcO">A Curl Helper Function for Easy API Testing</h1><p class="slug___StyledP-sc-8mhdoa-1 iRnBGj"><time dateTime="2021-09-06T18:23:42.735Z">September 6, 2021</time></p></header><article><div class="slug__BlogContentContainer-sc-8mhdoa-2 bWFbvA"><p>I tend to prefer command line tools for development, in this case choosing <code class="Code-sc-1amjnp4-0 iQzkww">curl</code> over Postman. Depending on the API that requests are being made to, curl commands can get out of hand, requiring numerous headers and other options to be manually attached on each request. The solution? Create a Bash helper function for curl, making our commands short and efficient.</p><p>The helper function:</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 fOgHwq  language-bash"><code class="  language-bash"><span class="token keyword">function</span> <span class="token function-name function">curls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> response_code_and_method
  <span class="token assign-left variable">response_code_and_method</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> <span class="token punctuation">\</span>
    --no-progress-meter <span class="token punctuation">\</span>
    --write-out <span class="token string">"%{response_code} %{method}"</span> <span class="token punctuation">\</span>
    --output /tmp/curls_body <span class="token punctuation">\</span>
    --header <span class="token string">"Content-Type: application/json"</span> <span class="token punctuation">\</span>
    $<span class="token punctuation">{</span>CURL_OPTIONS<span class="token punctuation">[</span>@<span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">\</span>
    $CURL_BASE_URL/$@
  <span class="token variable">)</span></span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">local</span> pretty_json
    <span class="token assign-left variable">pretty_json</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq --color-output <span class="token string">'.'</span> /tmp/curls_body <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null<span class="token variable">)</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      <span class="token builtin class-name">echo</span> <span class="token variable">$pretty_json</span>
    <span class="token keyword">else</span>
      <span class="token function">cat</span> /tmp/curls_body
      <span class="token builtin class-name">echo</span> <span class="token string">""</span>
    <span class="token keyword">fi</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token variable">$response_code_and_method</span>"</span>
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span></code></pre><p>In addition to providing a handful of &quot;default&quot; options to <code class="Code-sc-1amjnp4-0 iQzkww">curl</code>, we get some other benefits including:</p><ul><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>Pretty printing JSON responses with <code class="Code-sc-1amjnp4-0 iQzkww">jq</code> (conditionally, when a response is parse-able as JSON)</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>Using <code class="Code-sc-1amjnp4-0 iQzkww">${CURL_OPTIONS[@]}</code>, we can provide additional options through an environment variable. This may be preferred for temporarily adding additional options, rather than hard-coding them in our reusable Bash function.<br/>Further details on this option are shown below: <a href="#additional-notes" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS">Additional Notes</a></p></li><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>On the line <code class="Code-sc-1amjnp4-0 iQzkww">$CURL_BASE_URL/$@</code>, a variable representing the API&#x27;s base URL is automatically inserted for us. This would be set to a value such as <code class="Code-sc-1amjnp4-0 iQzkww">http://localhost:5000</code>. A trailing slash <code class="Code-sc-1amjnp4-0 iQzkww">/</code> is appended, and our arguments provided to <code class="Code-sc-1amjnp4-0 iQzkww">curls</code> are inserted here with <code class="Code-sc-1amjnp4-0 iQzkww">$@</code>.</p></li></ul><h2 id="example-usage">Example Usage</h2><p>Calling the endpoint <code class="Code-sc-1amjnp4-0 iQzkww">POST http://localhost:5000/test</code> with a request body can concisely be expressed as:</p><p><code class="Code-sc-1amjnp4-0 iQzkww">curls test -d &#x27;{&quot;key&quot;: &quot;value&quot;}&#x27;</code></p><p>Full example with a minimal Flask app:</p><p><img src="/assets/curls-flask.png" alt="Full example with a minimal Flask app" class="TreeToJSX__Img-sc-1taxolb-3 jvwBiV"/></p><h2 id="additional-notes">Additional Notes</h2><ul><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>Pretty printing JSON requires installing <a href="https://stedolan.github.io/jq/" target="_blank" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS">jq</a> (available from <code class="Code-sc-1amjnp4-0 iQzkww">brew</code>)</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>The <code class="Code-sc-1amjnp4-0 iQzkww">%{method}</code> formatter for the <code class="Code-sc-1amjnp4-0 iQzkww">--write-out</code> option requires curl 7.72.0+. <a href="https://curl.se/changes.html#7_72_0" target="_blank" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS">https://curl.se/changes.html#7_72_0</a><br/>The easiest way to install the latest version is <code class="Code-sc-1amjnp4-0 iQzkww">brew install curl</code> (OSX &amp; Linuxbrew). For me on Ubuntu, the version available via <code class="Code-sc-1amjnp4-0 iQzkww">apt</code> was an older version.</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>To get a better understanding of the Bash function and to modify it to your liking, I recommend this Bash cheatsheet: <a href="https://devhints.io/bash" target="_blank" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 kuhBS">https://devhints.io/bash</a></p></li><li class="TreeToJSX__Li-sc-1taxolb-2 dTmJnK"><p>Further explaining <code class="Code-sc-1amjnp4-0 iQzkww">${CURL_OPTIONS[@]}</code>, <code class="Code-sc-1amjnp4-0 iQzkww">CURL_OPTIONS</code> should be an array, whose elements are then expanded and space separated with <code class="Code-sc-1amjnp4-0 iQzkww">[@]</code>. For example, you may want to add another header containing your access token or API key.<br/>Example: <code class="Code-sc-1amjnp4-0 iQzkww">CURL_OPTIONS=(&quot;--header&quot; &quot;Authorization: Bearer &lt;your-access-token&gt;&quot;)</code></p></li></ul><p>For such a scenario, one alternative I&#x27;d recommend is creating a bash function to return the curl options array. By using a function, the array is evaluated when it&#x27;s called, not just when your <code class="Code-sc-1amjnp4-0 iQzkww">.bashrc</code>/<code class="Code-sc-1amjnp4-0 iQzkww">.zshrc</code> is sourced.</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 fOgHwq  language-bash"><code class="  language-bash"><span class="token keyword">function</span> <span class="token function-name function">get_curl_options</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">arr</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"--header"</span> <span class="token string">"Authorization: Bearer <span class="token variable">$ACCESS_TOKEN</span>"</span><span class="token punctuation">)</span>
  <span class="token builtin class-name">echo</span> <span class="token variable">$arr</span>
<span class="token punctuation">}</span>

<span class="token comment"># In function `curls`, replace `${CURL_OPTIONS[@]} \` with:</span>
<span class="token punctuation">..</span>.
<span class="token variable">${$(get_curl_options)<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span> <span class="token punctuation">\</span>
<span class="token punctuation">..</span>.</code></pre><p>By doing it this way with a function call, the array of options contains an up-to-date value for <code class="Code-sc-1amjnp4-0 iQzkww">$ACCESS_TOKEN</code>. You can reassign the value from the command line with <code class="Code-sc-1amjnp4-0 iQzkww">ACCESS_TOKEN=&quot;...&quot;</code>, and that value will be used in subsequent calls to our <code class="Code-sc-1amjnp4-0 iQzkww">curls</code> function.</p></div></article></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"A Curl Helper Function for Easy API Testing","date":"2021-09-06T18:23:42.735Z","content":"\nI tend to prefer command line tools for development, in this case choosing `curl` over Postman. Depending on the API that requests are being made to, curl commands can get out of hand, requiring numerous headers and other options to be manually attached on each request. The solution? Create a Bash helper function for curl, making our commands short and efficient.\n\nThe helper function:\n\n```bash\nfunction curls() {\n  local response_code_and_method\n  response_code_and_method=$(curl \\\n    --no-progress-meter \\\n    --write-out \"%{response_code} %{method}\" \\\n    --output /tmp/curls_body \\\n    --header \"Content-Type: application/json\" \\\n    ${CURL_OPTIONS[@]} \\\n    $CURL_BASE_URL/$@\n  )\n\n  if [ $? -eq 0 ]; then\n    local pretty_json\n    pretty_json=$(jq --color-output '.' /tmp/curls_body 2\u003e /dev/null)\n    if [ $? -eq 0 ]; then\n      echo $pretty_json\n    else\n      cat /tmp/curls_body\n      echo \"\"\n    fi\n    echo \"\\n$response_code_and_method\"\n  fi\n}\n```\n\nIn addition to providing a handful of \"default\" options to `curl`, we get some other benefits including:\n* Pretty printing JSON responses with `jq` (conditionally, when a response is parse-able as JSON)\n* Using `${CURL_OPTIONS[@]}`, we can provide additional options through an environment variable. This may be preferred for temporarily adding additional options, rather than hard-coding them in our reusable Bash function.  \nFurther details on this option are shown below: [Additional Notes](#additional-notes)\n* On the line `$CURL_BASE_URL/$@`, a variable representing the API's base URL is automatically inserted for us. This would be set to a value such as `http://localhost:5000`. A trailing slash `/` is appended, and our arguments provided to `curls` are inserted here with `$@`.\n\n## Example Usage\n\nCalling the endpoint `POST http://localhost:5000/test` with a request body can concisely be expressed as:\n\n`curls test -d '{\"key\": \"value\"}'`\n\nFull example with a minimal Flask app:\n\n![Full example with a minimal Flask app](/assets/curls-flask.png)\n\n## Additional Notes\n\n* Pretty printing JSON requires installing [jq](https://stedolan.github.io/jq/) (available from `brew`)\n* The `%{method}` formatter for the `--write-out` option requires curl 7.72.0+. \u003chttps://curl.se/changes.html#7_72_0\u003e  \nThe easiest way to install the latest version is `brew install curl` (OSX \u0026 Linuxbrew). For me on Ubuntu, the version available via `apt` was an older version.\n\n* To get a better understanding of the Bash function and to modify it to your liking, I recommend this Bash cheatsheet: \u003chttps://devhints.io/bash\u003e\n\n* Further explaining `${CURL_OPTIONS[@]}`, `CURL_OPTIONS` should be an array, whose elements are then expanded and space separated with `[@]`. For example, you may want to add another header containing your access token or API key.  \nExample: `CURL_OPTIONS=(\"--header\" \"Authorization: Bearer \u003cyour-access-token\u003e\")`\n\nFor such a scenario, one alternative I'd recommend is creating a bash function to return the curl options array. By using a function, the array is evaluated when it's called, not just when your `.bashrc`/`.zshrc` is sourced.\n```bash\nfunction get_curl_options() {\n  local arr=(\"--header\" \"Authorization: Bearer $ACCESS_TOKEN\")\n  echo $arr\n}\n\n# In function `curls`, replace `${CURL_OPTIONS[@]} \\` with:\n...\n${$(get_curl_options)[@]} \\\n...\n```\nBy doing it this way with a function call, the array of options contains an up-to-date value for `$ACCESS_TOKEN`. You can reassign the value from the command line with `ACCESS_TOKEN=\"...\"`, and that value will be used in subsequent calls to our `curls` function.\n","slug":"a-curl-helper-function-for-easy-api-testing"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"a-curl-helper-function-for-easy-api-testing"},"buildId":"RJhSgEuEM-DTGw2xptl7C","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Hitting a Target File Size With FFmpeg (Perfect for Discord Clips)</title><meta name="next-head-count" content="3"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/069ff64b07ed1af4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/069ff64b07ed1af4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-eae37baa130ab03a.js" defer=""></script><script src="/_next/static/chunks/framework-4556c45dd113b893.js" defer=""></script><script src="/_next/static/chunks/main-9d21f2f92d74d34f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-0f31e0da3388de53.js" defer=""></script><script src="/_next/static/chunks/792-95b7cdfb484c5ddc.js" defer=""></script><script src="/_next/static/chunks/519-ffc700f401ff0ed5.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-f09ac09cea7069b8.js" defer=""></script><script src="/_next/static/UAHHql_c8nX2t0A265gep/_buildManifest.js" defer=""></script><script src="/_next/static/UAHHql_c8nX2t0A265gep/_ssgManifest.js" defer=""></script><style data-styled="" data-styled-version="5.3.5">html{font-size:16px;min-height:100vh;}/*!sc*/
html,body{height:100%;margin:0;padding:0;}/*!sc*/
@media only screen and (max-device-width:480px){html{font-size:14px;}}/*!sc*/
body{background-color:#3e4d4f;color:white;font-family: -apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}/*!sc*/
*{box-sizing:border-box;}/*!sc*/
h1,h2,h3,h4,h5,h6{font-weight:400;}/*!sc*/
code,code[class*="language-"]{font-family: 'Inconsolata',Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;}/*!sc*/
data-styled.g1[id="sc-global-bLrfTZ1"]{content:"sc-global-bLrfTZ1,"}/*!sc*/
.oXjRv{background-color:#272822;padding:0.2em 0.4em;font-size:0.8em;border-radius:0.3em;color:#ae81ff;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g2[id="A__A_-sc-14fqd0c-0"]{content:"oXjRv,"}/*!sc*/
.hxcnSJ{height:1.534rem;width:1.534rem;padding:0.2em;margin-left:5px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}/*!sc*/
.hxcnSJ:hover > svg{stroke:#ae81ff;}/*!sc*/
data-styled.g3[id="RssLink___RssLink-sc-lk2wz-0"]{content:"hxcnSJ,"}/*!sc*/
.cbPkmK{height:100%;}/*!sc*/
data-styled.g4[id="RssLink___StyledSvg-sc-lk2wz-1"]{content:"cbPkmK,"}/*!sc*/
.lgEcag{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:1.2rem;margin:5px;}/*!sc*/
data-styled.g5[id="Navigation__Container-sc-10fffhi-0"]{content:"lgEcag,"}/*!sc*/
.bISkVn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-text-decoration:none;text-decoration:none;gap:5px;}/*!sc*/
data-styled.g6[id="Navigation__Nav-sc-10fffhi-1"]{content:"bISkVn,"}/*!sc*/
.ECCqO{color:white;font-weight:500;line-height:1;}/*!sc*/
data-styled.g7[id="Navigation___StyledSpan-sc-10fffhi-2"]{content:"ECCqO,"}/*!sc*/
.fRlBcp{background-color:#272822;padding:0.2em 0.4em;font-size:0.8em;border-radius:0.3em;}/*!sc*/
data-styled.g8[id="Code-sc-1amjnp4-0"]{content:"fRlBcp,"}/*!sc*/
.cTrNrc{margin-left:auto !important;margin-right:auto !important;}/*!sc*/
data-styled.g9[id="TreeToJSX__Pre-sc-1taxolb-0"]{content:"cTrNrc,"}/*!sc*/
.gacNJW > p{margin:0;}/*!sc*/
data-styled.g11[id="TreeToJSX__Li-sc-1taxolb-2"]{content:"gacNJW,"}/*!sc*/
.gjkXwZ{font-size:1.2em;line-height:1.4em;-webkit-letter-spacing:0.01em;-moz-letter-spacing:0.01em;-ms-letter-spacing:0.01em;letter-spacing:0.01em;overflow-wrap:break-word;padding:1.1em;margin:0 auto;}/*!sc*/
.gjkXwZ > *:not(pre){max-width:850px;margin-left:auto;margin-right:auto;}/*!sc*/
.gjkXwZ > pre{width:90vw;max-width:1100px;}/*!sc*/
data-styled.g14[id="BlogContent__Container-sc-10yyr2o-0"]{content:"gjkXwZ,"}/*!sc*/
.czPvNY{text-align:center;margin:2em;margin-bottom:0.2em;}/*!sc*/
data-styled.g15[id="slug___StyledH-sc-8mhdoa-0"]{content:"czPvNY,"}/*!sc*/
.eAxGCo{font-size:0.9em;text-align:center;}/*!sc*/
data-styled.g16[id="slug___StyledP-sc-8mhdoa-1"]{content:"eAxGCo,"}/*!sc*/
</style><style data-href="https://fonts.googleapis.com/css2?family=Inconsolata&display=swap">@font-face{font-family:'Inconsolata';font-style:normal;font-weight:400;font-stretch:normal;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8aRk&skey=20fa6569a31c71ee&v=v37) format('woff')}@font-face{font-family:'Inconsolata';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8WRL2kXWdycuJDETf&skey=20fa6569a31c71ee&v=v37) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Inconsolata';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8WRP2kXWdycuJDETf&skey=20fa6569a31c71ee&v=v37) format('woff');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Inconsolata';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/l/font?kit=QldgNThLqRwH-OJ1UHjlKENVzkWGVkL3GZQmAwLYxYWI2qfdm7Lpp4U8WR32kXWdycuJDA&skey=20fa6569a31c71ee&v=v37) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div><div class="Navigation__Container-sc-10fffhi-0 lgEcag"><nav class="Navigation__Nav-sc-10fffhi-1 bISkVn"><a href="/" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">/</a><span class="Navigation___StyledSpan-sc-10fffhi-2 ECCqO">&gt;</span><a href="/blog" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">blog</a><span class="Navigation___StyledSpan-sc-10fffhi-2 ECCqO">&gt;</span><a href="/blog/hitting-a-target-file-size-with-ffmpeg-perfect-for-discord-clips" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">hitting-a-target-file-size-with-ffmpeg-perfect-for-discord-clips</a></nav><a href="/blog/rss.xml" target="_blank" rel="noopener noreferrer" title="RSS Feed" class="A__A_-sc-14fqd0c-0 oXjRv RssLink___RssLink-sc-lk2wz-0 hxcnSJ"><svg xmlns="http://www.w3.org/2000/svg" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#ffffff" fill="none" stroke-linecap="round" stroke-linejoin="round" class="RssLink___StyledSvg-sc-lk2wz-1 cbPkmK"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="5" cy="19" r="1"></circle><path d="M4 4a16 16 0 0 1 16 16"></path><path d="M4 11a9 9 0 0 1 9 9"></path></svg></a></div><main><header><h1 class="slug___StyledH-sc-8mhdoa-0 czPvNY">Hitting a Target File Size With FFmpeg (Perfect for Discord Clips)</h1><p class="slug___StyledP-sc-8mhdoa-1 eAxGCo"><time dateTime="2025-12-10T12:43:16.627Z">December 10, 2025</time></p></header><article><div class="BlogContent__Container-sc-10yyr2o-0 gjkXwZ"><p>If you&#x27;ve ever tried to send a gaming clip over Discord as a free user, you&#x27;ve run into the 10MB upload limit. My process before creating this script was to use a collection of other ffmpeg commands to trial-and-error trimming the clip, and lowering the quality until it finally went below the 10MB threshold.</p><p>I wanted a way to say: <b>&quot;Here&#x27;s my clip. Make it 10MB. Do what you must.&quot;</b></p><p>So I wrote a Bash function that uses FFmpeg&#x27;s 2‑pass encoding method to reliably target a specific file size. It also has quality‑of‑life options for trimming timestamps. As you&#x27;ll see below, you can write other bash functions which call the main function to make this process happen by typing just a few characters into your terminal.</p><p>My setup:</p><ul><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p>Gaming on Windows, running the script in WSL (Git Bash will work too)</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p>Shadowplay 1 minute instant replay saved videos</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p>Discord 10MB file upload limit (non-Nitro paid users)</p></li></ul><h2 id="requirements">Requirements</h2><ul><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p>A Bash shell to run the script: Linux, WSL, or Git Bash</p></li><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p>FFmpeg (should include <code class="Code-sc-1amjnp4-0 fRlBcp">ffmpeg</code> &amp; <code class="Code-sc-1amjnp4-0 fRlBcp">ffprobe</code>)</p></li></ul><p><b>NOTE</b> I have FFmpeg installed in my Linux distro mounted in WSL (more on that <a href="/blog/accessing-a-dual-boot-linux-install-in-wsl-with-chroot" target="_self" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">here</a>), but using WSL with FFmpeg installed in Windows, with the exe accessible in your <code class="Code-sc-1amjnp4-0 fRlBcp">$PATH</code> should work too.</p><h2 id="the-scripts">The Scripts</h2><p>Also available as a <a href="https://gist.github.com/zzzachzzz/1a1e056160c5fd79262bf702022cfe59" target="_blank" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">GitHub Gist</a></p><h3 id="vidunderfilesizesh"><code class="Code-sc-1amjnp4-0 fRlBcp">vidunderfilesize.sh</code></h3><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-bash" tabindex="0"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token builtin class-name">eval</span> <span class="token builtin class-name">set</span> -- <span class="token string">"<span class="token variable"><span class="token variable">$(</span>
  getopt <span class="token punctuation">\</span>
    --options s:e:i:o:k:a: <span class="token punctuation">\</span>
    --longoptions start:,end:,input:,output:,output-filesize-kb:,audio-bitrate-kbps: <span class="token punctuation">\</span>
    -- <span class="token string">"<span class="token variable">$@</span>"</span>
<span class="token variable">)</span></span>"</span>

<span class="token keyword">while</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">case</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token keyword">in</span>
    -s<span class="token operator">|</span>--start<span class="token punctuation">)</span> <span class="token assign-left variable">start_arg</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -e<span class="token operator">|</span>--end<span class="token punctuation">)</span> <span class="token assign-left variable">end_arg</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -i<span class="token operator">|</span>--input<span class="token punctuation">)</span> <span class="token assign-left variable">input</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -o<span class="token operator">|</span>--output<span class="token punctuation">)</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -k<span class="token operator">|</span>--output-filesize-kb<span class="token punctuation">)</span> <span class="token assign-left variable">output_filesize_kb</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -a<span class="token operator">|</span>--audio-bitrate-kbps<span class="token punctuation">)</span> <span class="token assign-left variable">audio_bitrate_kbps</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span><span class="token punctuation">;</span> <span class="token builtin class-name">shift</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
    --<span class="token punctuation">)</span> <span class="token builtin class-name">shift</span><span class="token punctuation">;</span> <span class="token builtin class-name">break</span> <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">esac</span>
<span class="token keyword">done</span>

<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">":"</span> <span class="token builtin class-name">read</span> -ra start_array <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$start_arg</span>"</span>
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">":"</span> <span class="token builtin class-name">read</span> -ra end_array <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"<span class="token variable">$end_arg</span>"</span>

<span class="token comment"># Prepend default zeros, filling arrays to 3 slots</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span> ${#start_array[@]} <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token assign-left variable">start_array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token variable">${start_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">)</span>
<span class="token keyword">done</span>
<span class="token keyword">while</span> <span class="token variable"><span class="token punctuation">((</span> ${#end_array[@]} <span class="token operator">&lt;</span> <span class="token number">3</span> <span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token assign-left variable">end_array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token variable">${end_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span><span class="token punctuation">)</span>
<span class="token keyword">done</span>

<span class="token comment"># Pad left 2 digits for each slot</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${<span class="token operator">!</span>start_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  start_array<span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">"%02d"</span> $<span class="token punctuation">{</span>start_array<span class="token punctuation">[</span>$i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token variable">)</span></span>
<span class="token keyword">done</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token string">"<span class="token variable">${<span class="token operator">!</span>end_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  end_array<span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">"%02d"</span> $<span class="token punctuation">{</span>end_array<span class="token punctuation">[</span>$i<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token variable">)</span></span>
<span class="token keyword">done</span>

<span class="token assign-left variable">start_hours_part</span><span class="token operator">=</span><span class="token variable">${start_array<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>
<span class="token assign-left variable">start_minutes_part</span><span class="token operator">=</span><span class="token variable">${start_array<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>
<span class="token assign-left variable">start_seconds_part</span><span class="token operator">=</span><span class="token variable">${start_array<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>
<span class="token assign-left variable">start_seconds</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $start_seconds_part <span class="token operator">+</span> $start_minutes_part <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> $start_hours_part <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token variable">))</span></span>
<span class="token assign-left variable">start_time</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$start_hours_part</span>:<span class="token variable">$start_minutes_part</span>:<span class="token variable">$start_seconds_part</span>"</span>

<span class="token comment"># If no end timestamp supplied (or user provided zeroes), get duration of video</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${end_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span> <span class="token operator">==</span> <span class="token string">"00 00 00"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token assign-left variable">raw_duration_decimal</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>
    ffprobe -v error -select_streams v:0 -show_entries <span class="token assign-left variable">stream</span><span class="token operator">=</span>duration <span class="token punctuation">\</span>
    -of <span class="token assign-left variable">default</span><span class="token operator">=</span>noprint_wrappers<span class="token operator">=</span><span class="token number">1</span>:nokey<span class="token operator">=</span><span class="token number">1</span> <span class="token string">"<span class="token variable">$input</span>"</span>
  <span class="token variable">)</span></span>"</span>
  <span class="token assign-left variable">end_seconds</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">awk</span> -v <span class="token assign-left variable">d</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$raw_duration_decimal</span>"</span> <span class="token string">'BEGIN {print int(d)}'</span><span class="token variable">)</span></span>"</span>
  <span class="token comment"># `end_time` intentionally not set</span>
<span class="token keyword">else</span>
  <span class="token assign-left variable">end_hours_part</span><span class="token operator">=</span><span class="token variable">${end_array<span class="token punctuation">[</span>0<span class="token punctuation">]</span>}</span>
  <span class="token assign-left variable">end_minutes_part</span><span class="token operator">=</span><span class="token variable">${end_array<span class="token punctuation">[</span>1<span class="token punctuation">]</span>}</span>
  <span class="token assign-left variable">end_seconds_part</span><span class="token operator">=</span><span class="token variable">${end_array<span class="token punctuation">[</span>2<span class="token punctuation">]</span>}</span>
  <span class="token assign-left variable">end_seconds</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $end_seconds_part <span class="token operator">+</span> $end_minutes_part <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> $end_hours_part <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token variable">))</span></span>
  <span class="token assign-left variable">end_time</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$end_hours_part</span>:<span class="token variable">$end_minutes_part</span>:<span class="token variable">$end_seconds_part</span>"</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">duration_seconds</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $end_seconds <span class="token operator">-</span> $start_seconds <span class="token variable">))</span></span>

<span class="token assign-left variable">default_audio_bitrate_kbps</span><span class="token operator">=</span><span class="token string">"128"</span>
<span class="token assign-left variable">audio_bitrate_kbps</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${audio_bitrate_kbps<span class="token operator">:-</span>$default_audio_bitrate_kbps}</span>"</span>
<span class="token assign-left variable">audio_total_kb</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $audio_bitrate_kbps <span class="token operator">*</span> $duration_seconds <span class="token variable">))</span></span>

<span class="token assign-left variable">_10MB_in_kb</span><span class="token operator">=</span><span class="token string">"80000"</span> <span class="token comment"># 10 megabyte == 80,000 kilobits</span>
<span class="token assign-left variable">output_filesize_kb</span><span class="token operator">=</span><span class="token variable">${output_filesize_kb<span class="token operator">:-</span>$_10MB_in_kb}</span>

<span class="token assign-left variable">video_bitrate_kbps</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> <span class="token punctuation">(</span> $output_filesize_kb <span class="token operator">-</span> $audio_total_kb <span class="token punctuation">)</span> <span class="token operator">/</span> $duration_seconds <span class="token variable">))</span></span>

<span class="token comment"># tmp file written to in 1st pass and read in 2nd pass</span>
<span class="token assign-left variable">ffmpeg_stats_file</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>mktemp --tmpdir --dry-run ffmpeg_stats_XXXXXX<span class="token variable">)</span></span>"</span>

<span class="token assign-left variable">maybe_to</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> -n $end_time <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"-to <span class="token variable">$end_time</span>"</span><span class="token variable">)</span></span>"</span>
<span class="token assign-left variable">ffmpeg_common_output_file_options</span><span class="token operator">=</span><span class="token string">"\
-ss <span class="token variable">$start_time</span> <span class="token variable">$maybe_to</span> \
-c:v libx264 -b:v <span class="token variable">${video_bitrate_kbps}</span>k \
-maxrate 5M -bufsize 10M \
-passlogfile <span class="token variable">$ffmpeg_stats_file</span> \
<span class="token variable">$FFMPEG_OUTPUT_FILE_OPTIONS</span>\
"</span>

<span class="token comment"># 1st pass ffmpeg analyzes video and outputs stats file to `$ffmpeg_stats_file*`,</span>
<span class="token comment"># to accurately target `$output_filesize_kb` based on specified bitrates.</span>
ffmpeg -y -i <span class="token string">"<span class="token variable">$input</span>"</span> <span class="token punctuation">\</span>
  <span class="token variable">$ffmpeg_common_output_file_options</span> <span class="token punctuation">\</span>
  -pass <span class="token number">1</span> <span class="token punctuation">\</span>
  -an -f mp4 <span class="token punctuation">\</span>
  /dev/null

<span class="token comment"># 2nd pass produces actual video output, reading from stats files produced in 1st pass</span>
ffmpeg -i <span class="token string">"<span class="token variable">$input</span>"</span> <span class="token punctuation">\</span>
  <span class="token variable">$ffmpeg_common_output_file_options</span> <span class="token punctuation">\</span>
  -pass <span class="token number">2</span> <span class="token punctuation">\</span>
  -c:a aac -b:a <span class="token string">"<span class="token variable">${audio_bitrate_kbps}</span>k"</span> <span class="token punctuation">\</span>
  <span class="token string">"<span class="token variable">$output</span>"</span>

<span class="token comment"># Clean up tmp files, mbtree file is ~20MB</span>
<span class="token function">rm</span> <span class="token string">"<span class="token variable">$ffmpeg_stats_file</span>"</span>*.log<span class="token punctuation">{</span>,.mbtree<span class="token punctuation">}</span>
</code></pre><p>Additionally, here is my own helper function I use for calling the main script. I suggest you create one too.</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-bash" tabindex="0"><code class="language-bash"><span class="token keyword">function</span> <span class="token function-name function">meleeclip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">end</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">input</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$3</span>"</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$4</span>"</span>
  <span class="token comment"># Defaults for empty start &amp; end options handled in `vidunderfilesize.sh`</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$start</span>"</span> <span class="token operator">==</span> <span class="token string">"-"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token string">""</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$end</span>"</span> <span class="token operator">==</span> <span class="token string">"-"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token assign-left variable">end</span><span class="token operator">=</span><span class="token string">""</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$input</span>"</span> <span class="token operator">||</span> <span class="token string">"<span class="token variable">$input</span>"</span> <span class="token operator">==</span> <span class="token string">"-"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">input_dir</span><span class="token operator">=</span><span class="token string">"/mnt/d/storage/Videos/shadowplay/slippi dolphin.exe"</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">newest_file</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">ls</span> -tp <span class="token string">"<span class="token variable">$input_dir</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token string">"/$"</span> <span class="token operator">|</span> <span class="token function">head</span> -n <span class="token number">1</span><span class="token variable">)</span></span>"</span>
    <span class="token assign-left variable">input</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${input_dir}</span>/<span class="token variable">${newest_file}</span>"</span>
  <span class="token keyword">fi</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">"<span class="token variable">$output</span>"</span> <span class="token operator">||</span> <span class="token string">"<span class="token variable">$output</span>"</span> <span class="token operator">==</span> <span class="token string">"-"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output_dir</span><span class="token operator">=</span><span class="token string">"/mnt/d/storage/Videos/shadowplay/slippi dolphin.exe/cropped-clips"</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output_filename</span><span class="token operator">=</span><span class="token string">"_NEW_CLIP_NAME_ME_<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token string">"<span class="token variable">$input</span>"</span><span class="token variable">)</span></span>"</span>
    <span class="token assign-left variable">output</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${output_dir}</span>/<span class="token variable">${output_filename}</span>"</span>
  <span class="token keyword">fi</span>

  <span class="token assign-left variable">FFMPEG_OUTPUT_FILE_OPTIONS</span><span class="token operator">=</span><span class="token string">"-vf crop=in_h*4/3:in_h"</span> <span class="token punctuation">\</span>
    ~/bin/vidunderfilesize.sh <span class="token punctuation">\</span>
    --start<span class="token operator">=</span><span class="token string">"<span class="token variable">$start</span>"</span> <span class="token punctuation">\</span>
    --end<span class="token operator">=</span><span class="token string">"<span class="token variable">$end</span>"</span> <span class="token punctuation">\</span>
    --input<span class="token operator">=</span><span class="token string">"<span class="token variable">$input</span>"</span> <span class="token punctuation">\</span>
    --output<span class="token operator">=</span><span class="token string">"<span class="token variable">$output</span>"</span>
<span class="token punctuation">}</span></code></pre><h2 id="usage">Usage</h2><p><code class="Code-sc-1amjnp4-0 fRlBcp">FFMPEG_OUTPUT_FILE_OPTIONS</code> is an option you probably don&#x27;t need. Here I am cropping to 4:3 aspect ratio to closely match <a href="https://melee.tv" target="_blank" rel="noopener noreferrer" class="A__A_-sc-14fqd0c-0 oXjRv">Slippi Dolphin Melee&#x27;s</a> internal resolution of 73:60.</p><p>The <code class="Code-sc-1amjnp4-0 fRlBcp">--start</code> and <code class="Code-sc-1amjnp4-0 fRlBcp">--end</code> options allow you to specify the timestamps you want to trim the clip to. The parsing is flexible and allows for these example inputs, converting to <code class="Code-sc-1amjnp4-0 fRlBcp">hh:mm:ss</code>.</p><ul><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p><code class="Code-sc-1amjnp4-0 fRlBcp">5</code> -&gt; <code class="Code-sc-1amjnp4-0 fRlBcp">00:00:05</code></p></li><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p><code class="Code-sc-1amjnp4-0 fRlBcp">1:50</code> -&gt; <code class="Code-sc-1amjnp4-0 fRlBcp">00:01:50</code></p></li><li class="TreeToJSX__Li-sc-1taxolb-2 gacNJW"><p><code class="Code-sc-1amjnp4-0 fRlBcp">01:1:01</code> -&gt; <code class="Code-sc-1amjnp4-0 fRlBcp">01:01:01</code></p></li></ul><p>With the <code class="Code-sc-1amjnp4-0 fRlBcp">meleeclip</code> helper function I have, this is how I would typically call it:</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-bash" tabindex="0"><code class="language-bash"><span class="token comment"># Let's say we want to clip from 00:00:36 to the end of my 1 minute clip</span>
meleeclip <span class="token number">36</span>

<span class="token comment"># Or from 00:00:36 to 00:00:50</span>
meleeclip <span class="token number">36</span> <span class="token number">50</span></code></pre><p>That&#x27;s it, since I have the <code class="Code-sc-1amjnp4-0 fRlBcp">meleeclip</code> function default to use the newest file in my shadowplay directory as input, and a fixed output directory with a generated filename that I just go and rename separately after.</p><h2 id="explanation">Explanation</h2><p>Bitrate is predictable for producing a given filesize. File size is basically:</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-none" tabindex="0"><code class="language-none">file_size_bits ≈ bitrate_bits_per_sec × duration_sec</code></pre><p>So if you want a 10MB clip:</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-none" tabindex="0"><code class="language-none">10 MB (Megabytes) = 80 Mb (megabits)
10 MB = 80000 Kb (kilobits)
target_bitrate_kbps = 80000 Kb / duration_seconds</code></pre><p>In the script, we calculate the maximum video bitrate we can use:</p><pre class="TreeToJSX__Pre-sc-1taxolb-0 cTrNrc language-bash" tabindex="0"><code class="language-bash"><span class="token assign-left variable">video_bitrate_kbps</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> <span class="token punctuation">(</span> $output_filesize_kb <span class="token operator">-</span> $audio_total_kb <span class="token punctuation">)</span> <span class="token operator">/</span> $duration_seconds <span class="token variable">))</span></span></code></pre><p>Once you know the exact bitrate needed, FFmpeg can aim for it, and using <b>2‑pass encoding</b>, it can hit that target very accurately.</p></div></article></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Hitting a Target File Size With FFmpeg (Perfect for Discord Clips)","date":"2025-12-10T12:43:16.627Z","content":"\nIf you've ever tried to send a gaming clip over Discord as a free user, you've run into the 10MB upload limit. My process before creating this script was to use a collection of other ffmpeg commands to trial-and-error trimming the clip, and lowering the quality until it finally went below the 10MB threshold.\n\nI wanted a way to say: **\"Here's my clip. Make it 10MB. Do what you must.\"**\n\nSo I wrote a Bash function that uses FFmpeg's 2‑pass encoding method to reliably target a specific file size. It also has quality‑of‑life options for trimming timestamps. As you'll see below, you can write other bash functions which call the main function to make this process happen by typing just a few characters into your terminal.\n\nMy setup:\n\n- Gaming on Windows, running the script in WSL (Git Bash will work too)\n- Shadowplay 1 minute instant replay saved videos\n- Discord 10MB file upload limit (non-Nitro paid users)\n\n## Requirements\n- A Bash shell to run the script: Linux, WSL, or Git Bash\n- FFmpeg (should include `ffmpeg` \u0026 `ffprobe`)\n\n**NOTE** I have FFmpeg installed in my Linux distro mounted in WSL (more on that [here](/blog/accessing-a-dual-boot-linux-install-in-wsl-with-chroot)), but using WSL with FFmpeg installed in Windows, with the exe accessible in your `$PATH` should work too.\n\n## The Scripts\n\nAlso available as a [GitHub Gist](https://gist.github.com/zzzachzzz/1a1e056160c5fd79262bf702022cfe59)\n\n### `vidunderfilesize.sh`\n\n```bash\n#!/usr/bin/env bash\n\neval set -- \"$(\n  getopt \\\n    --options s:e:i:o:k:a: \\\n    --longoptions start:,end:,input:,output:,output-filesize-kb:,audio-bitrate-kbps: \\\n    -- \"$@\"\n)\"\n\nwhile true; do\n  case \"$1\" in\n    -s|--start) start_arg=\"$2\"; shift 2 ;;\n    -e|--end) end_arg=\"$2\"; shift 2 ;;\n    -i|--input) input=\"$2\"; shift 2 ;;\n    -o|--output) output=\"$2\"; shift 2 ;;\n    -k|--output-filesize-kb) output_filesize_kb=\"$2\"; shift 2 ;;\n    -a|--audio-bitrate-kbps) audio_bitrate_kbps=\"$2\"; shift 2 ;;\n    --) shift; break ;;\n  esac\ndone\n\nIFS=\":\" read -ra start_array \u003c\u003c\u003c \"$start_arg\"\nIFS=\":\" read -ra end_array \u003c\u003c\u003c \"$end_arg\"\n\n# Prepend default zeros, filling arrays to 3 slots\nwhile (( ${#start_array[@]} \u003c 3 )); do\n  start_array=(0 ${start_array[@]})\ndone\nwhile (( ${#end_array[@]} \u003c 3 )); do\n  end_array=(0 ${end_array[@]})\ndone\n\n# Pad left 2 digits for each slot\nfor i in \"${!start_array[@]}\"; do\n  start_array[$i]=$(printf \"%02d\" ${start_array[$i]})\ndone\nfor i in \"${!end_array[@]}\"; do\n  end_array[$i]=$(printf \"%02d\" ${end_array[$i]})\ndone\n\nstart_hours_part=${start_array[0]}\nstart_minutes_part=${start_array[1]}\nstart_seconds_part=${start_array[2]}\nstart_seconds=$(( $start_seconds_part + $start_minutes_part * 60 + $start_hours_part * 60 * 60 ))\nstart_time=\"$start_hours_part:$start_minutes_part:$start_seconds_part\"\n\n# If no end timestamp supplied (or user provided zeroes), get duration of video\nif [[ \"${end_array[@]}\" == \"00 00 00\" ]]; then\n  raw_duration_decimal=\"$(\n    ffprobe -v error -select_streams v:0 -show_entries stream=duration \\\n    -of default=noprint_wrappers=1:nokey=1 \"$input\"\n  )\"\n  end_seconds=\"$(awk -v d=\"$raw_duration_decimal\" 'BEGIN {print int(d)}')\"\n  # `end_time` intentionally not set\nelse\n  end_hours_part=${end_array[0]}\n  end_minutes_part=${end_array[1]}\n  end_seconds_part=${end_array[2]}\n  end_seconds=$(( $end_seconds_part + $end_minutes_part * 60 + $end_hours_part * 60 * 60 ))\n  end_time=\"$end_hours_part:$end_minutes_part:$end_seconds_part\"\nfi\n\nduration_seconds=$(( $end_seconds - $start_seconds ))\n\ndefault_audio_bitrate_kbps=\"128\"\naudio_bitrate_kbps=\"${audio_bitrate_kbps:-$default_audio_bitrate_kbps}\"\naudio_total_kb=$(( $audio_bitrate_kbps * $duration_seconds ))\n\n_10MB_in_kb=\"80000\" # 10 megabyte == 80,000 kilobits\noutput_filesize_kb=${output_filesize_kb:-$_10MB_in_kb}\n\nvideo_bitrate_kbps=$(( ( $output_filesize_kb - $audio_total_kb ) / $duration_seconds ))\n\n# tmp file written to in 1st pass and read in 2nd pass\nffmpeg_stats_file=\"$(mktemp --tmpdir --dry-run ffmpeg_stats_XXXXXX)\"\n\nmaybe_to=\"$([[ -n $end_time ]] \u0026\u0026 echo \"-to $end_time\")\"\nffmpeg_common_output_file_options=\"\\\n-ss $start_time $maybe_to \\\n-c:v libx264 -b:v ${video_bitrate_kbps}k \\\n-maxrate 5M -bufsize 10M \\\n-passlogfile $ffmpeg_stats_file \\\n$FFMPEG_OUTPUT_FILE_OPTIONS\\\n\"\n\n# 1st pass ffmpeg analyzes video and outputs stats file to `$ffmpeg_stats_file*`,\n# to accurately target `$output_filesize_kb` based on specified bitrates.\nffmpeg -y -i \"$input\" \\\n  $ffmpeg_common_output_file_options \\\n  -pass 1 \\\n  -an -f mp4 \\\n  /dev/null\n\n# 2nd pass produces actual video output, reading from stats files produced in 1st pass\nffmpeg -i \"$input\" \\\n  $ffmpeg_common_output_file_options \\\n  -pass 2 \\\n  -c:a aac -b:a \"${audio_bitrate_kbps}k\" \\\n  \"$output\"\n\n# Clean up tmp files, mbtree file is ~20MB\nrm \"$ffmpeg_stats_file\"*.log{,.mbtree}\n\n```\n\nAdditionally, here is my own helper function I use for calling the main script. I suggest you create one too.\n\n```bash\nfunction meleeclip() {\n  local start=\"$1\"\n  local end=\"$2\"\n  local input=\"$3\"\n  local output=\"$4\"\n  # Defaults for empty start \u0026 end options handled in `vidunderfilesize.sh`\n  [[ \"$start\" == \"-\" ]] \u0026\u0026 start=\"\"\n  [[ \"$end\" == \"-\" ]] \u0026\u0026 end=\"\"\n\n  if [[ -z \"$input\" || \"$input\" == \"-\" ]]; then\n    local input_dir=\"/mnt/d/storage/Videos/shadowplay/slippi dolphin.exe\"\n    local newest_file=\"$(ls -tp \"$input_dir\" | grep -v \"/$\" | head -n 1)\"\n    input=\"${input_dir}/${newest_file}\"\n  fi\n\n  if [[ -z \"$output\" || \"$output\" == \"-\" ]]; then\n    local output_dir=\"/mnt/d/storage/Videos/shadowplay/slippi dolphin.exe/cropped-clips\"\n    local output_filename=\"_NEW_CLIP_NAME_ME_$(basename \"$input\")\"\n    output=\"${output_dir}/${output_filename}\"\n  fi\n\n  FFMPEG_OUTPUT_FILE_OPTIONS=\"-vf crop=in_h*4/3:in_h\" \\\n    ~/bin/vidunderfilesize.sh \\\n    --start=\"$start\" \\\n    --end=\"$end\" \\\n    --input=\"$input\" \\\n    --output=\"$output\"\n}\n```\n\n## Usage\n\n`FFMPEG_OUTPUT_FILE_OPTIONS` is an option you probably don't need. Here I am cropping to 4:3 aspect ratio to closely match [Slippi Dolphin Melee's](https://melee.tv) internal resolution of 73:60.\n\nThe `--start` and `--end` options allow you to specify the timestamps you want to trim the clip to. The parsing is flexible and allows for these example inputs, converting to `hh:mm:ss`.\n\n- `5` -\u003e `00:00:05`\n- `1:50` -\u003e `00:01:50`\n- `01:1:01` -\u003e `01:01:01`\n\nWith the `meleeclip` helper function I have, this is how I would typically call it:\n\n```bash\n# Let's say we want to clip from 00:00:36 to the end of my 1 minute clip\nmeleeclip 36\n\n# Or from 00:00:36 to 00:00:50\nmeleeclip 36 50\n```\n\nThat's it, since I have the `meleeclip` function default to use the newest file in my shadowplay directory as input, and a fixed output directory with a generated filename that I just go and rename separately after.\n\n## Explanation\n\nBitrate is predictable for producing a given filesize. File size is basically:\n\n```\nfile_size_bits ≈ bitrate_bits_per_sec × duration_sec\n```\n\nSo if you want a 10MB clip:\n\n```\n10 MB (Megabytes) = 80 Mb (megabits)\n10 MB = 80000 Kb (kilobits)\ntarget_bitrate_kbps = 80000 Kb / duration_seconds\n```\n\nIn the script, we calculate the maximum video bitrate we can use:\n```bash\nvideo_bitrate_kbps=$(( ( $output_filesize_kb - $audio_total_kb ) / $duration_seconds ))\n```\n\nOnce you know the exact bitrate needed, FFmpeg can aim for it, and using **2‑pass encoding**, it can hit that target very accurately.\n\n","slug":"hitting-a-target-file-size-with-ffmpeg-perfect-for-discord-clips"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"hitting-a-target-file-size-with-ffmpeg-perfect-for-discord-clips"},"buildId":"UAHHql_c8nX2t0A265gep","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>